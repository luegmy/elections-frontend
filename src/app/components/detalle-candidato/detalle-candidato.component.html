<div class="detalle-container" *ngIf="candidate">
  <div class="top-header-ultra-compact">
    <div class="header-left-side">
      <button (click)="goBack()" class="btn-back-smart">← Volver</button>
      <div class="candidate-main-info">
        <h1 class="candidate-name">{{ candidate?.name }}</h1>
        <p class="candidate-party-text">{{ candidate?.party }}</p>
      </div>
    </div>
    <div class="level-pill" [class]="'level-' + candidate?.rankingLevel">
      <span class="lvl-label">NIVEL</span>
      <span class="lvl-num">{{ candidate?.rankingLevel }}</span>
    </div>
  </div>

  <div id="anchor-top" style="scroll-margin-top: 150px;"></div>

  <div class="nav-scores-container">
    <div class="scores-group side">
      <div class="score-card-mini" [ngClass]="getScoreClass(candidate?.scores?.judicialScore)" (click)="scrollToSection('transparencia')">
        <span class="s-label">INTEGRIDAD</span>
        <span class="s-val" [style.color]="getScoreColor(candidate?.scores?.judicialScore)">
          {{ candidate?.scores?.judicialScore | number:'1.0-1' }}
        </span>
      </div>
      <div class="score-card-mini" [ngClass]="getScoreClass(candidate?.scores?.contributionScore)" (click)="scrollToSection('logros')">
        <span class="s-label">APORTES</span>
        <span class="s-val" [style.color]="getScoreColor(candidate?.scores?.contributionScore)">
          {{ candidate?.scores?.contributionScore | number:'1.0-1' }}
        </span>
      </div>
    </div>

    <div class="scores-group-center">
      <div class="score-card-main" [ngClass]="getScoreClass(candidate?.scores?.planScore)" (click)="scrollToSection('judicial')">
        <span class="s-label">PLAN DE GOBIERNO</span>
        <span class="s-val" [style.color]="getScoreColor(candidate?.scores?.planScore)">
          {{ candidate?.scores?.planScore | number:'1.0-1' }}
        </span>
      </div>
      <div class="score-card-main" [ngClass]="getScoreClass(candidate?.scores?.finalScore)">
        <span class="s-label">GLOBAL</span>
        <span class="s-val" [style.color]="getScoreColor(candidate?.scores?.finalScore)">
          {{ candidate?.scores?.finalScore | number:'1.0-1' }}
        </span>
      </div>
    </div>

    <div class="scores-group side">
      <div class="score-card-mini" [ngClass]="getScoreClass(candidate?.scores?.trustScore)" (click)="scrollToSection('confianza')">
        <span class="s-label">CONFIANZA</span>
        <span class="s-val" [style.color]="getScoreColor(candidate?.scores?.trustScore)">
          {{ candidate?.scores?.trustScore | number:'1.0-1' }}
        </span>
      </div>
      <div class="score-card-mini" [ngClass]="getScoreClass(candidate?.scores?.transparencyScore)" (click)="scrollToSection('propuestas')">
        <span class="s-label">TRANSPARENCIA</span>
        <span class="s-val" [style.color]="getScoreColor(candidate?.scores?.transparencyScore)">
          {{ candidate?.scores?.transparencyScore | number:'1.0-1' }}
        </span>
      </div>
    </div>
  </div>

  <div class="content-body-spacer">
    
    <section class="section-box" id="propuestas">
      <h2 class="section-title-return" (click)="scrollToSection('anchor-top')">PLAN DE GOBIERNO ▲</h2>
      <div *ngFor="let p of candidate?.proposals; let i = index" class="proposal-card">
        <div class="proposal-header" (click)="toggleItem(expandedProposals, i)">
          <div class="header-left">
            <span class="area-tag">{{ p.area }}</span>
            <span class="proposal-title">{{ p.title }}</span>
          </div>
          <span class="chevron">{{ expandedProposals.get(i) ? '−' : '+' }}</span>
        </div>
        <div class="proposal-body" *ngIf="expandedProposals.get(i)">
          <div class="source-info">FUENTE: {{ p.sourcePlan }}</div>
          <p class="proposal-desc">{{ p.detailDescription }}</p>
          <div class="proposal-two-columns">
            <div class="p-col">
              <div class="stat-item">
                <span class="s-label">Viabilidad: {{ p.feasibilityScore * 100 }}%</span>
                <div class="bar-container"><div class="bar-fill" [style.width.%]="p.feasibilityScore * 100"></div></div>
              </div>
              <div class="stat-item">
                <span class="s-label">Impacto: {{ p.impactScore * 100 }}%</span>
                <div class="bar-container"><div class="bar-fill impact" [style.width.%]="p.impactScore * 100"></div></div>
              </div>
            </div>
            <div class="p-col">
              <div class="tech-row"><span>Costo:</span> {{ p.costEstimate }}</div>
              <div class="tech-row" [class.text-red]="p.requiresConstitutionalReform"><span>Reforma:</span> {{ p.requiresConstitutionalReform ? 'SÍ' : 'NO' }}</div>
              <div class="tech-row" [class.text-red]="p.violatesInternationalTreaties"><span>Tratados:</span> {{ p.violatesInternationalTreaties ? 'VULNERA' : 'RESPETA' }}</div>
            </div>
          </div>
        </div>
      </div>
    </section>

<section class="section-box" id="judicial">
  <h2 class="section-title-return" (click)="scrollToSection('anchor-top')">HISTORIAL JUDICIAL ▲</h2>
  <div *ngFor="let h of candidate?.history; let i = index" 
       class="legal-card" 
       [ngClass]="{
         'b-grave': h.severity === 'GRAVE', 
         'b-mod': h.severity === 'MODERADO',
         'b-leve': h.severity === 'LEVE',
         'b-neu': h.severity === 'NEUTRO'
       }">
    <div class="legal-header" (click)="toggleItem(expandedHistory, i)">
      <div class="header-left">
        <span class="sev-dot" 
              [ngClass]="{
                'bg-grave': h.severity === 'GRAVE', 
                'bg-mod': h.severity === 'MODERADO',
                'bg-leve': h.severity === 'LEVE',
                'bg-neu': h.severity === 'NEUTRO'
              }"></span>
        <span class="legal-title">{{ h.title }}</span>
      </div>
      <div class="header-right">
        <span class="verified-pill" *ngIf="h.verified">VERIFICADO</span>
        <span class="chevron">{{ expandedHistory.get(i) ? '−' : '+' }}</span>
      </div>
    </div>
    </div>
</section>

    <section class="section-box" id="logros">
      <h2 class="section-title-return" (click)="scrollToSection('anchor-top')">LOGROS Y APORTES ▲</h2>
      <div class="achievements-container">
        <div *ngFor="let a of candidate?.achievements" class="achievement-item">
          <span class="dot-green"></span>
          <p>{{ a.description }}</p>
        </div>
      </div>
    </section>

    <div class="compact-dual-grid">
      <div class="data-card" id="transparencia">
        <div class="card-mini-header">TRANSPARENCIA</div>
        <div class="row"><span>Hoja de Vida:</span> <span class="text-green">PRESENTADA</span></div>
        <div class="row"><span>Inconsistencias:</span> <span [class.text-red]="candidate?.transparency?.declarationInconsistencies > 0">{{ candidate?.transparency?.declarationInconsistencies }}</span></div>
        <div class="row"><span>Asistencia:</span> <span class="text-green">{{ candidate?.transparency?.attendancePercentage }}%</span></div>
        <div class="row"><span>Ingresos:</span> <span class="text-green">SÍ</span></div>
        <div class="row"><span>Auditorías:</span> <span class="text-green">DISPONIBLES</span></div>
      </div>
      <div class="data-card" id="confianza">
        <div class="card-mini-header">CONFIANZA</div>
        <div class="row"><span>Mayores:</span> <span class="text-red">{{ candidate?.trust?.majorSanctions }}</span></div>
        <div class="row"><span>Cambios Partido:</span> <span class="text-orange">{{ candidate?.trust?.partySwitches }}</span></div>
        <div class="row"><span>Fact-Check:</span> <span class="text-red">{{ candidate?.trust?.factCheckFailures }}</span></div>
        <div class="row"><span>Sanción Ética:</span> <span class="text-green">NINGUNA</span></div>
      </div>
    </div>
  </div>
</div>